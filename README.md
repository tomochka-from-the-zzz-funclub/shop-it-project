# shop-it-project

# Архитектура системы

Этот проект представляет собой систему для управления товарами, пользователями и заказами, с микросервисной архитектурой. Каждый компонент системы разделен на отдельные микросервисы, которые выполняют специфические функции. Все сервисы взаимодействуют через REST API, а для мониторинга и поиска используется **Prometheus** и **Grafana**.

## Архитектура

Система состоит из следующих основных микросервисов:

- **Сервис товаров**
- **Сервис пользователей**
- **Сервис заказов**
- **API Gateway** (Прокси-сервер)
- **Мониторинг (Prometheus + Grafana)**

Каждый микросервис выполняет свою задачу и предоставляет REST API для взаимодействия.

## Сервисы и их методы

### 1. Сервис товаров

**Методы:**

- **POST /products** — Создание нового товара.
  - Параметры: название, описание, цена, категория и т.д.
  - Возвращает: ID нового товара.

- **GET /products/{id}** — Получение информации о товаре по его ID.
  - Параметры: ID товара.
  - Возвращает: данные о товаре.

- **GET /products** — Получение списка товаров с фильтрами (категория, цена и т.д.).
  - Параметры: фильтры для поиска.
  - Возвращает: список товаров.

- **PUT /products/{id}** — Обновление информации о товаре.
  - Параметры: обновленные данные товара.
  - Возвращает: статус успешного обновления.

- **DELETE /products/{id}** — Удаление товара.
  - Параметры: ID товара.
  - Возвращает: статус успешного удаления.

- **POST /products/search** — Поиск товаров.
  - Параметры: критерии поиска (название, категория и т.д.).
  - Возвращает: результаты поиска через **Elasticsearch**.

**Логирование:**
- Логирование всех операций с товарами: создание, обновление, удаление, поиск.

**Реализация:**
- Язык: Go или Node.js.
- База данных: PostgreSQL.
- Поиск: Elasticsearch.
- Логирование: Prometheus, JSON логи.

---

### 2. Сервис пользователей

**Методы:**

- **POST /users/register** — Регистрация нового пользователя.
  - Параметры: имя, email, пароль.
  - Возвращает: статус регистрации и ID пользователя.

- **POST /users/login** — Аутентификация пользователя.
  - Параметры: email и пароль.
  - Возвращает: JWT токен.

- **GET /users/{id}** — Получение информации о пользователе.
  - Параметры: ID пользователя.
  - Возвращает: данные о пользователе.

- **PUT /users/{id}** — Обновление данных пользователя.
  - Параметры: обновленные данные (имя, email и т.д.).
  - Возвращает: статус обновления.

- **POST /users/logout** — Выход из системы.
  - Возвращает: статус выхода.

**Логирование:**
- Логирование регистрации и входа пользователя.
- Логирование изменений профиля пользователя.

**Реализация:**
- Язык: Go или Node.js.
- База данных: PostgreSQL.
- Аутентификация: JWT.
- Логирование: Prometheus, JSON логи.

---

### 3. Сервис заказов

**Методы:**

- **POST /orders** — Создание нового заказа.
  - Параметры: пользователь, список товаров, сумма.
  - Возвращает: ID нового заказа.

- **GET /orders/{id}** — Получение информации о заказе.
  - Параметры: ID заказа.
  - Возвращает: данные о заказе.

- **PUT /orders/{id}** — Обновление статуса заказа.
  - Параметры: новый статус заказа.
  - Возвращает: статус успешного обновления.

- **GET /orders/user/{user_id}** — Получение всех заказов пользователя.
  - Параметры: ID пользователя.
  - Возвращает: список заказов.

**Логирование:**
- Логирование всех операций с заказами: создание, изменение статуса, ошибки.

**Реализация:**
- Язык: Go или Node.js.
- База данных: PostgreSQL.
- Логирование: Prometheus, JSON логи.

---

## 4. API Gateway

**Описание:**  
API Gateway является точкой входа в систему. Он маршрутизирует запросы к соответствующим микросервисам, а также выполняет аутентификацию и авторизацию пользователей.

**Методы:**

- **GET /products/{id}** — Маршрутизирует запрос к сервису товаров.
- **POST /products** — Маршрутизирует запрос к сервису товаров.
- **POST /users/register** — Маршрутизирует запрос к сервису пользователей.
- **POST /users/login** — Маршрутизирует запрос к сервису пользователей.
- **POST /orders** — Маршрутизирует запрос к сервису заказов.

**Реализация:**
- Язык: Nginx, Kong, Traefik или облачные решения (например, AWS API Gateway).
- Аутентификация: JWT.

---

### 5. Мониторинг (Prometheus + Grafana)

**Описание:**  
Используется для сбора метрик с каждого микросервиса и их визуализации.

**Метрики:**
- Количество запросов.
- Время отклика.
- Статусы HTTP-ответов.

**Реализация:**
- **Prometheus** собирает метрики с сервисов.
- **Grafana** визуализирует данные.

---

## Общие рекомендации по реализации

1. **Проектирование и структуры данных:**
   - Для каждого микросервиса необходимо спроектировать структуру базы данных.
   - Используйте **PostgreSQL** для хранения данных о пользователях, товарах и заказах.
   - Используйте **Elasticsearch** для поиска товаров.

2. **Аутентификация и авторизация:**
   - Для авторизации используйте **JWT** токены.
   - API Gateway проверяет JWT токены для защищенных эндпоинтов.

3. **Интерфейс между микросервисами:**
   - Микросервисы общаются через REST API.
   - Для асинхронной обработки событий можно использовать очередь сообщений (например, **RabbitMQ** или **Kafka**).

4. **Логирование и мониторинг:**
   - Используйте **Prometheus** для сбора метрик.
   - Логи могут храниться в формате **JSON** и отправляться в централизованное хранилище (**ELK Stack** или **Grafana Loki**).

5. **Масштабирование:**
   - Каждый микросервис можно масштабировать горизонтально с помощью **Docker** и **Kubernetes**.

6. **CI/CD:**
   - Настройте конвейеры CI/CD для автоматического деплоя и тестирования каждого микросервиса.

---
**Структура проекта**
```bash
├── products-service/     # Сервис для управления товарами
├── users-service/        # Сервис для управления пользователями
├── orders-service/       # Сервис для управления заказами
├── api-gateway/          # API Gateway для маршрутизации запросов
├── monitoring/           # Конфигурации для мониторинга
└── docker-compose.yml     # Конфигурация для Docker Compose
```
Важные зависимости
- PostgreSQL — для хранения данных.
- Elasticsearch — для поиска товаров.
- Prometheus — для сбора метрик.
- Grafana — для визуализации метрик.
- Nginx/Kong/Traefik — для API Gateway.


Конечно! Давайте разберём каждую команду, используемую в процессе работы с `golang-migrate`, и объясним, что означает каждая часть:

### 1️⃣ Проверка установленного migrate

```sh
$(go env GOPATH)/bin/migrate -version
```
- **`$(go env GOPATH)`**: Эта команда возвращает путь к вашему `GOPATH`, который является рабочим каталогом для Go-проектов.
- **`/bin/migrate`**: Это путь к исполняемому файлу `migrate`, который должен находиться в каталоге `bin` вашего `GOPATH`.
- **`-version`**: Этот аргумент показывает установленную версию `migrate`. Если команда не найдена, это означает, что `migrate` не установлен.

### 2️⃣ Установка golang-migrate

```sh
go install -tags 'postgres' github.com/golang-migrate/migrate/v4/cmd/migrate@v4.15.2
```
- **`go install`**: Команда для установки пакета Go.
- **`-tags 'postgres'`**: Указывает, что вы хотите установить версию, поддерживающую PostgreSQL. Это может быть важно, если вы используете другие базы данных, так как могут быть разные теги.
- **`github.com/golang-migrate/migrate/v4/cmd/migrate@v4.15.2`**: Это путь к репозиторию, где находится код `golang-migrate`, и конкретная версия, которую вы хотите установить (в данном случае `v4.15.2`).

### 3️⃣ Добавление пути к Go-бинам в PATH

```sh
export PATH=$PATH:$(go env GOPATH)/bin
```
- **`export PATH=`**: Эта команда изменяет переменную окружения `PATH`, добавляя в неё новый путь.
- **`$PATH`**: Существующие пути в переменной `PATH`.
- **`$(go env GOPATH)/bin`**: Добавляет путь к каталогу `bin` вашего `GOPATH`, где находится исполняемый файл `migrate`.

### 4️⃣ Создание файлов миграций

```sh
migrate create -ext sql -dir migrations -seq init_schema
```
- **`migrate create`**: Команда для создания новой миграции.
- **`-ext sql`**: Указывает, что файлы миграции будут иметь расширение `.sql`.
- **`-dir migrations`**: Указывает каталог, в котором будут созданы файлы миграций (в данном случае — `migrations`).
- **`-seq`**: Указывает, что миграции должны быть пронумерованы по порядку.
- **`init_schema`**: Имя миграции, которое будет использоваться для создания файлов (например, `000001_init_schema.up.sql` и `000001_init_schema.down.sql`).

### 5️⃣ Запуск миграций

#### Применение миграций

```sh
migrate -path migrations -database "postgres://user:password@localhost:5432/dbname?sslmode=disable" up
```
- **`migrate`**: Команда для работы с миграциями.
- **`-path migrations`**: Указывает путь к каталогу, где находятся ваши миграции.
- **`-database "postgres://user:password@localhost:5432/dbname?sslmode=disable"`**: URL для подключения к вашей базе данных PostgreSQL. Здесь:
  - `user`: имя пользователя базы данных.
  - `password`: пароль пользователя.
  - `localhost`: адрес сервера базы данных.
  - `5432`: порт, на котором работает PostgreSQL.
  - `dbname`: имя базы данных.
  - `sslmode=disable`: указывает, что SSL не используется.
- **`up`**: Аргумент, который указывает, что нужно применить миграции (вверх).

#### Откат миграций

```sh
migrate -path migrations -database "postgres://user:password@localhost:5432/dbname?sslmode=disable" down
```
- Все параметры аналогичны предыдущей команде, но вместо `up` используется `down`, что означает откат последней миграции.



